  window.requestAnimationFrame(function() {
                    nav.classList.toggle('scrolled', window.scrollY > 80);
                    ticking = false;
                });
                ticking = true;
            }
        }, { passive: true });
    })();
    </script>
    <?php
});

/**
 * FAQ accordion functionality
 */
add_action('wp_footer', function () {
    ?>
    <script>
    (function() {
        document.querySelectorAll('.lc-faq-trigger').forEach(function(trigger) {
            trigger.addEventListener('click', function() {
                const item = this.closest('.lc-faq-item');
                const wasOpen = item.classList.contains('open');
                // Close all siblings
                item.parentElement.querySelectorAll('.lc-faq-item.open').forEach(function(el) {
                    el.classList.remove('open');
                });
                // Toggle clicked
                if (!wasOpen) item.classList.add('open');
            });
        });
    })();
    </script>
    <?php
});

/**
 * Reading progress bar (for article pages)
 */
add_action('wp_footer', function () {
    if (!is_singular()) return;
    ?>
    <script>
    (function() {
        const bar = document.querySelector('.lc-progress-bar-fill');
        const article = document.querySelector('.lc-article');
        if (!bar || !article) return;

        window.addEventListener('scroll', function() {
            const rect = article.getBoundingClientRect();
            const total = article.scrollHeight - window.innerHeight;
            const scrolled = -rect.top;
            const pct = Math.min(100, Math.max(0, (scrolled / total) * 100));
            bar.style.width = pct + '%';
        }, { passive: true });
    })();
    </script>
    <?php
});

/**
 * TOC active section tracking (for article pages)
 */
add_action('wp_footer', function () {
    if (!is_singular()) return;
    ?>
    <script>
    (function() {
        const tocLinks = document.querySelectorAll('.lc-toc-link');
        if (!tocLinks.length) return;

        const ids = Array.from(tocLinks).map(a => a.getAttribute('href').replace('#', ''));

        window.addEventListener('scroll', function() {
            let active = ids[0];
            for (let i = ids.length - 1; i >= 0; i--) {
                const el = document.getElementById(ids[i]);
                if (el && el.getBoundingClientRect().top < 140) {
                    active = ids[i];
                    break;
                }
            }
            tocLinks.forEach(link => {
                link.classList.toggle('active', link.getAttribute('href') === '#' + active);
            });
        }, { passive: true });
    })();
    </script>
    <?php
});

/**
 * Register custom block patterns
 */
add_action('init', function () {
    $patterns_dir = get_stylesheet_directory() . '/patterns/';

    if (!is_dir($patterns_dir)) return