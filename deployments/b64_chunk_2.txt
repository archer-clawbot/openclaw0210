lIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIAKCi8qKgogKiBHRVQgL29wZW5jbGF3L3YxL3N1YnNjcmlwdGlvbi9zdGF0dXM/ZW1haWw9Y3VzdG9tZXJAZXhhbXBsZS5jb20KICovCmZ1bmN0aW9uIG9wZW5jbGF3X2dldF9zdWJzY3JpcHRpb25fc3RhdHVzKFdQX1JFU1RfUmVxdWVzdCAkcmVxdWVzdCk6IFdQX1JFU1RfUmVzcG9uc2UgewogICAgJGVtYWlsID0gJHJlcXVlc3QtPmdldF9wYXJhbSgnZW1haWwnKTsKCiAgICAvLyBGaW5kIGN1c3RvbWVyIGJ5IGVtYWlsCiAgICAkY3VzdG9tZXIgPSBnZXRfdXNlcl9ieSgnZW1haWwnLCAkZW1haWwpOwogICAgaWYgKCEkY3VzdG9tZXIpIHsKICAgICAgICByZXR1cm4gbmV3IFdQX1JFU1RfUmVzcG9uc2UoWwogICAgICAgICAgICAnc3RhdHVzJyA9PiAnbm9uZScsCiAgICAgICAgICAgICdtZXNzYWdlJyA9PiAnTm8gY3VzdG9tZXIgZm91bmQgd2l0aCB0aGlzIGVtYWlsLicsCiAgICAgICAgXSwgMjAwKTsgLy8gMjAwIG5vdCA0MDQg4oCUICJubyBzdWJzY3JpcHRpb24iIGlzIGEgdmFsaWQgcmVzcG9uc2UsIG5vdCBhbiBlcnJvcgogICAgfQoKICAgIC8vIEdldCBhY3RpdmUgc3Vic2NyaXB0aW9ucyBmb3IgdGhpcyBjdXN0b21lcgogICAgaWYgKCFmdW5jdGlvbl9leGlzdHMoJ3djc19nZXRfdXNlcnNfc3Vic2NyaXB0aW9ucycpKSB7CiAgICAgICAgcmV0dXJuIG5ldyBXUF9SRVNUX1Jlc3BvbnNlKFsKICAgICAgICAgICAgJ2Vycm9yJyA9PiAnV29vQ29tbWVyY2UgU3Vic2NyaXB0aW9ucyBub3QgYWN0aXZlLicsCiAgICAgICAgXSwgNTAzKTsKICAgIH0KCiAgICAkc3Vic2NyaXB0aW9ucyA9IHdjc19nZXRfdXNlcnNfc3Vic2NyaXB0aW9ucygkY3VzdG9tZXItPklEKTsKICAgICRhY3RpdmUgPSBudWxsOwoKICAgIGZvcmVhY2ggKCRzdWJzY3JpcHRpb25zIGFzICRzdWIpIHsKICAgICAgICBpZiAoJHN1Yi0+aGFzX3N0YXR1cyhbJ2FjdGl2ZScsICdwZW5kaW5nLWNhbmNlbCddKSkgewogICAgICAgICAgICAkYWN0aXZlID0gJHN1YjsKICAgICAgICAgICAgYnJlYWs7IC8vIFVzZSB0aGUgZmlyc3QgYWN0aXZlIHN1YnNjcmlwdGlvbgogICAgICAgIH0KICAgIH0KCiAgICBpZiAoISRhY3RpdmUpIHsKICAgICAgICByZXR1cm4gbmV3IFdQX1JFU1RfUmVzcG9uc2UoWwogICAgICAgICAgICAnc3RhdHVzJyA9PiAnaW5hY3RpdmUnLAogICAgICAgICAgICAnY3VzdG9tZXJfaWQnID0+ICRjdXN0b21lci0+SUQsCiAgICAgICAgICAgICdlbWFpbCcgPT4gJGVtYWlsLAogICAgICAgIF0sIDIwMCk7CiAgICB9CgogICAgLy8gR2V0IHRoZSBzdWJzY3JpcHRpb24gcHJvZHVjdCBhbmQgaXRzIE9wZW5DbGF3IG1ldGEKICAgICRpdGVtcyA9ICRhY3RpdmUtPmdldF9pdGVtcygpOwogICAgJHByb2R1Y3QgPSBudWxsOwogICAgZm9yZWFjaCAoJGl0ZW1zIGFzICRpdGVtKSB7CiAgICAgICAgJHByb2R1Y3QgPSAkaXRlbS0+Z2V0X3Byb2R1Y3QoKTsKICAgICAgICBicmVhazsKICAgIH0KCiAgICAkdGllciA9ICRwcm9kdWN0ID8gZ2V0X3Bvc3RfbWV0YSgkcHJvZHVjdC0+Z2V0X2lkKCksICdfb3BlbmNsYXdfdGllcicsIHRydWUpIDogJ3Vua25vd24nOwogICAgJG1heF9hZ2VudHMgPSAkcHJvZHVjdCA/IGludHZhbChnZXRfcG9zdF9tZXRhKCRwcm9kdWN0LT5nZXRfaWQoKSwgJ19vcGVuY2xhd19tYXhfYWdlbnRzJywgdHJ1ZSkpIDogMDsKICAgICRtYXhfdGFza3MgPSAkcHJvZHVjdCA/IGludHZhbChnZXRfcG9zdF9tZXRhKCRwcm9kdWN0LT5nZXRfaWQoKSwgJ19vcGVuY2xhd19tYXhfdGFza3NfbW9udGhseScsIHRydWUpKSA6IDA7CgogICAgcmV0dXJuIG5ldyBXUF9SRVNUX1Jlc3BvbnNlKFsKICAgICAgICAnc3RhdHVzJyA9PiAkYWN0aXZlLT5nZXRfc3RhdHVzKCksIC8vICdhY3RpdmUnIG9yICdwZW5kaW5nLWNhbmNlbCcKICAgICAgICAnY3VzdG9tZXJfaWQnID0+ICRjdXN0b21lci0+SUQsCiAgICAgICAgJ2VtYWlsJyA9PiAkZW1haWwsCiAgICAgICAgJ3N1YnNjcmlwdGlvbl9pZCcgPT4gJGFjdGl2ZS0+Z2V0X2lkKCksCiAgICAgICAgJ3RpZXInID0+ICR0aWVyLAogICAgICAgICdmbGVldF9hY2Nlc3MnID0+IFsKICAgICAgICAgICAgJ21heF9hZ2VudHMnID0+ICRtYXhfYWdlbnRzLAogICAgICAgICAgICAnbWF4X3Rhc2tzX21vbnRobHknID0+ICRtYXhfdGFza3MsCiAgICAgICAgXSwKICAgICAgICAnY3VycmVudF9wZXJpb2RfZW5kJyA9PiAkYWN0aXZlLT5nZXRfZGF0ZSgnbmV4dF9wYXltZW50JyksCiAgICAgICAgJ2NyZWF0ZWQnID0+ICRhY3RpdmUtPmdldF9kYXRlKCdzdGFydCcpLAogICAgXSwgMjAwKTsKfQoKLyoqCiAqIEdFVCAvb3BlbmNsYXcvdjEvc3Vic2NyaXB0aW9uL2FsbC1hY3RpdmUKICovCmZ1bmN0aW9uIG9wZW5jbGF3X2dldF9hbGxfYWN0aXZlX3N1YnNjcmlwdGlvbnMoV1BfUkVTVF9SZXF1ZXN0ICRyZXF1ZXN0KTogV1BfUkVTVF9SZXNwb25zZSB7CiAgICBpZiAoIWZ1bmN0aW9uX2V4aXN0cygnd2NzX2dldF9zdWJzY3JpcHRpb25zJykpIHsKICAgICAgICByZXR1cm4gbmV3IFdQX1JFU1RfUmVzcG9uc2UoWydlcnJvcicgPT4gJ1dvb0NvbW1lcmNlIFN1YnNjcmlwdGlvbnMgbm90IGFjdGl2ZS4nXSwgNTAzKTsKICAgIH0KCiAgICAkc3Vic2NyaXB0aW9ucyA9IHdjc19nZXRfc3Vic2NyaXB0aW9ucyhbCiAgICAgICAgJ3N1YnNjcmlwdGlvbl9zdGF0dXMnID0+IFsnYWN0aXZlJywgJ3BlbmRpbmctY2FuY2VsJ10sCiAgICAgICAgJ3N1YnNjcmlwdGlvbnNfcGVyX3BhZ2UnID0+IDEwMCwKICAgIF0pOwoKICAgICRyZXN1bHRzID0gW107CiAgICBmb3JlYWNoICgkc3Vic2NyaXB0aW9ucyBhcyAkc3ViKSB7CiAgICAgICAgJGN1c3RvbWVyID0gJHN1Yi0+Z2V0X3VzZXIoKTsKICAgICAgICAkaXRlbXMgPSAkc3ViLT5nZXRfaXRlbXMoKTsKICAgICAgICAkcHJvZHVjdCA9IG51bGw7CiAgICAgICAgZm9yZWFjaCAoJGl0ZW1zIGFzICRpdGVtKSB7CiAgICAgICAgICAgICRwcm9kdWN0ID0gJGl0ZW0tPmdldF9wcm9kdWN0KCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgJHRpZXIgPSAkcHJvZHVjdCA/IGdldF9wb3N0X21ldGEoJHByb2R1Y3QtPmdldF9pZCgpLCAnX29wZW5jbGF3X3RpZXInLCB0cnVlKSA6ICd1bmtub3duJzsKICAgICAgICAkbWF4X2FnZW50cyA9ICRwcm9kdWN0ID8gaW50dmFsKGdldF9wb3N0X21ldGEoJHByb2R1Y3QtPmdldF9pZCgpLCAnX29wZW5jbGF3X21heF9hZ2VudHMnLCB0cnVlKSkgOiAwOwogICAgICAgICRtYXhfdGFza3MgPSAkcHJvZHVjdCA/IGludHZhbChnZXRfcG9zdF9tZXRhKCRwcm9kdWN0LT5nZXRfaWQoKSwgJ19vcGVuY2xhd19tYXhfdGFza3NfbW9udGhseScsIHRydWUpKSA6IDA7CgogICAgICAgICRyZXN1bHRzW10gPSBbCiAgICAgICAgICAgICdjdXN0b21lcl9pZCcgPT4gJGN1c3RvbWVyID8gJGN1c3RvbWVyLT5JRCA6IG51bGwsCiAgICAgICAgICAgICdlbWFpbCcgPT4gJGN1c3RvbWVyID8gJGN1c3RvbWVyLT51c2VyX2VtYWlsIDogbnVsbCwKICAgICAgICAgICAgJ3N1YnNjcmlwdGlvbl9pZCcgPT4gJHN1Yi0+Z2V0X2lkKCksCiAgICAgICAgICAgICdzdGF0dXMnID0+ICRzdWItPmdldF9zdGF0dXMoKSwKICAgICAgICAgICAgJ3RpZXInID0+ICR0aWVyLAogICAgICAgICAgICAnZmxlZXRfYWNjZXNzJyA9PiBbCiAgICAgICAgICAgICAgICAnbWF4X2FnZW50cycgPT4g