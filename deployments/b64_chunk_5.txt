ke form in the dashboard.

add_action('woocommerce_thankyou', function ($order_id) {
    $order = wc_get_order($order_id);
    if (!$order) return;

    $access_token = $order->get_meta('_openclaw_access_token');
    if (!$access_token || $access_token === 'EXISTING_ORDER') return;

    $product_slug = $order->get_meta('_openclaw_product_slug');

    // Dashboard intake form URL — wp-config.php constant or WP option
    $dashboard_url = defined('OPENCLAW_DASHBOARD_URL')
        ? OPENCLAW_DASHBOARD_URL
        : (get_option('openclaw_dashboard_url') ?: 'https://dashboard.localcatalyst.com');

    $intake_url = rtrim($dashboard_url, '/') . "/intake/{$order_id}?token=" . urlencode($access_token);

    // Output a redirect notice + auto-redirect after 5 seconds
    echo '<div class="openclaw-intake-notice" style="margin: 20px 0; padding: 20px; background: #f0f9ff; border: 2px solid #0ea5e9; border-radius: 8px; text-align: center;">';
    echo '<h3 style="margin: 0 0 10px;">Almost Done! Complete Your Intake Form</h3>';
    echo '<p>To get started on your order, please fill out a quick intake form with your business details.</p>';
    echo '<a href="' . esc_url($intake_url) . '" style="display: inline-block; padding: 12px 24px; background: #0ea5e9; color: white; text-decoration: none; border-radius: 6px; font-weight: 600;">Complete Intake Form &rarr;</a>';
    echo '<p style="margin-top: 10px; font-size: 0.85em; color: #64748b;">You\'ll be redirected automatically in 5 seconds...</p>';
    echo '</div>';
    echo '<script>setTimeout(function(){ window.location.href = "' . esc_js($intake_url) . '"; }, 5000);</script>';
}, 5);

// ─── SUBSCRIPTION CHANGE NOTIFICATIONS ───────────────────────────────
// When a subscription status changes, notify the fleet dispatcher so it
// can update customer access immediately.

add_action('woocommerce_subscription_status_updated', function ($subscription, $new_status, $old_status) {
    $fleet_webhook_url = defined('OPENCLAW_FLEET_WEBHOOK_URL')
        ? OPENCLAW_FLEET_WEBHOOK_URL
        : null;

    if (!$fleet_webhook_url) {
        return; // Fleet webhook not configured
    }

    $customer = $subscription->get_user();
    $items = $subscription->get_items();
    $product = null;
    foreach ($items as $item) {
        $product = $item->get_product();
        break;
    }

    $tier = $product ? get_post_meta($product->get_id(), '_openclaw_tier', true) : 'unknown';

    $body = json_encode([
        'event' => 'subscription.status_changed',
        'customer_email' => $customer ? $customer->user_email : null,
        'customer_id' => $customer ? $customer->ID : null,
        'subscription_id' => $subscription->get_id(),
        'old_status' => $old_status,
        'new_status' => $new_status,
        'tier' => $tier,
        'timestamp' => time(),
    ]);

    // Sign the outbound webhook with HMAC
    $timestamp = time();
    $body_hash = hash('sha256', $body);
    $payload = "{$timestamp}:POST:/openclaw/subscription-event:{$body_hash}";
    $signature = hash_hmac('sha256', $payload, OPENCLAW_BRIDGE_SECRET);

    // Fire-and-forget POST to fleet
    wp_remote_post($fleet_webhook_url, [
        'body' => $body,
        'headers' => [
            'Content-Type' => 'application/json',
            'X-OpenClaw-Timestamp' => $timestamp,
            'X-OpenClaw-Signature' => $signature,
        ],
        'timeout' => 5,
        'blocking' => false, // Don't wait for response
    ]);
}, 10, 3);
