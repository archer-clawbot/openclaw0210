 as $item) {
            $product = $item->get_product();
            break;
        }

        $tier = $product ? get_post_meta($product->get_id(), '_openclaw_tier', true) : 'unknown';
        $max_agents = $product ? intval(get_post_meta($product->get_id(), '_openclaw_max_agents', true)) : 0;
        $max_tasks = $product ? intval(get_post_meta($product->get_id(), '_openclaw_max_tasks_monthly', true)) : 0;

        $results[] = [
            'customer_id' => $customer ? $customer->ID : null,
            'email' => $customer ? $customer->user_email : null,
            'subscription_id' => $sub->get_id(),
            'status' => $sub->get_status(),
            'tier' => $tier,
            'fleet_access' => [
                'max_agents' => $max_agents,
                'max_tasks_monthly' => $max_tasks,
            ],
            'current_period_end' => $sub->get_date('next_payment'),
        ];
    }

    return new WP_REST_Response([
        'count' => count($results),
        'subscriptions' => $results,
    ], 200);
}

/**
 * POST /openclaw/v1/fleet/health
 * Receives fleet health status and stores it as a transient for the customer dashboard.
 */
function openclaw_receive_fleet_health(WP_REST_Request $request): WP_REST_Response {
    $data = $request->get_json_params();

    // Store as WordPress transient (expires after 10 minutes)
    set_transient('openclaw_fleet_health', [
        'received_at' => current_time('mysql'),
        'agents_active' => $data['agents_active'