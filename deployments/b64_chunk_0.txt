<?php
/**
 * Plugin Name: OpenClaw Fleet Bridge
 * Description: Authenticated REST API bridge between OpenClaw fleet and WordPress/WooCommerce.
 * Version: 1.0.0
 * Author: OpenClaw / Spartan Digital
 * Requires at least: 6.0
 */

if (!defined('ABSPATH')) {
    exit;
}

// ─── CONFIG ──────────────────────────────────────────────────────────

// Shared secret for HMAC-SHA256 request signing.
// Set in wp-config.php: define('OPENCLAW_BRIDGE_SECRET', 'your-64-char-hex-string');
// Generate with: openssl rand -hex 32
if (!defined('OPENCLAW_BRIDGE_SECRET')) {
    // Fail loudly if not configured — don't silently operate without auth
    add_action('admin_notices', function () {
        echo '<div class="error"><p><strong>OpenClaw Bridge:</strong> OPENCLAW_BRIDGE_SECRET is not defined in wp-config.php. Bridge endpoints are disabled.</p></div>';
    });
    return; // Don't register any endpoints
}

define('OPENCLAW_BRIDGE_VERSION', '1.0.0');
define('OPENCLAW_BRIDGE_TIMESTAMP_TOLERANCE', 300); // 5 minutes
define('OPENCLAW_BRIDGE_NAMESPACE', 'openclaw/v1');

// ─── HMAC AUTHENTICATION ─────────────────────────────────────────────

/**
 * Verify HMAC-SHA256 signature on incoming requests.
 *
 * Expected headers:
 *   X-OpenClaw-Timestamp: Unix timestamp (seconds)
 *   X-OpenClaw-Signature: HMAC-SHA256 hex digest
 *
 * Signature covers: timestamp + ":" + HTTP_METHOD + ":" + request_path + ":" + sha256(body)
 */
function openclaw_verify_hmac(WP_REST_Request $request) {
    $timestamp = $request->get_header('X-OpenClaw-Timestamp');
    $signature = $request->get_header('X-OpenClaw-Signature');

    if (!$timestamp || !$signature) {
        return new WP_Error(
            'openclaw_missing_auth',
            'Missing X-OpenClaw-Timestamp or X-OpenClaw-Signature header.',
            ['status' => 401]
        );
    }

    // Replay protection — reject requests older than 5 minutes
    $now = time();
    if (abs($now - intval($timestamp)) > OPENCLAW_BRIDGE_TIMESTAMP_TOLERANCE) {
        return new WP_Error(
            'openclaw_expired',
            'Request timestamp outside tolerance window.',
            ['status' => 401]
        );
    }

    // Reconstruct the signed payload
    $method = $request->get_method();
    $path = $request->get_route();
    $body = $request->get_body();
    $body_hash = hash('sha256', $body ?: '');
    $payload = "{$timestamp}:{$method}:{$path}:{$body_hash}";

    // Compute expected signature
    $expected = hash_hmac('sha256', $payload, OPENCLAW_BRIDGE_SECRET);

    // Constant-time comparison to prevent timing attacks
    if (!hash_equals($expected, $signature)) {
        error_log("[OpenClaw Bridge] HMAC verification failed from " . $_SERVER['REMOTE_ADDR']);
        return new WP_Error(
            'openclaw_invalid_signature',
            'HMAC signature verification failed.',
            ['status' => 403]
        );
    }

    return true;
}

/**
 * WP REST permission callback using HMAC verification.
 */
function openclaw_hmac_permission(WP_REST_Request $request) {
    $result = openclaw_verify_hmac($request);
    if (is_wp_error($result)) {
        return $result;
    }
    return true;
}

// ─── REST API ENDPOINTS ──────────────────────────────────────────────

add_action('rest_api_init', function () {

    // GET /openclaw/v1/subscription/status?email=customer@example.com
    // Returns subscription tier and fleet access limits for a cu