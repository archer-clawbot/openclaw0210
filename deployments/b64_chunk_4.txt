 || !$convex_token) {
        error_log("[OpenClaw Bridge] CONVEX_SITE_URL or CONVEX_API_TOKEN not configured — skipping order webhook for #{$order_id}");
        return;
    }

    $order = wc_get_order($order_id);
    if (!$order) {
        error_log("[OpenClaw Bridge] Cannot load WC order #{$order_id}");
        return;
    }

    $customer_email = $order->get_billing_email();
    $customer_name = trim($order->get_billing_first_name() . ' ' . $order->get_billing_last_name());

    // Process each line item that has OpenClaw agent metadata
    foreach ($order->get_items() as $item) {
        $product = $item->get_product();
        if (!$product) continue;

        $product_id = $product->get_id();
        // Check for OpenClaw agent mapping on this product
        $agent_id = get_post_meta($product_id, '_openclaw_agent_id', true);
        if (!$agent_id) {
            // Not an OpenClaw-fulfillable product — skip
            continue;
        }

        // Get parent product ID for variations
        $wc_product_id = $product->is_type('variation')
            ? $product->get_parent_id()
            : $product_id;
        $wc_variation_id = $product->is_type('variation')
            ? $product_id
            : null;

        $line_total = intval(round($item->get_total() * 100)); // Convert to cents

        $payload = [
            'wcOrderId' => intval($order_id),
            'wcProductId' => intval($wc_product_id),
            'customerEmail' => $customer_email,
            'customerName' => $customer_name,
            'totalAmount' => $line_total,
            'currency' => $order->get_currency(),
            'tenantId' => 'localcatalyst',
        ];

        if ($wc_variation_id) {
            $payload['wcVariationId'] = intval($wc_variation_id);
        }

        // POST to Convex /orders/webhook with Bearer token auth
        $response = wp_remote_post(rtrim($convex_url, '/') . '/orders/webhook', [
            'body' => json_encode($payload),
            'headers' => [
                'Content-Type' => 'application/json',
                'Authorization' => 'Bearer ' . $convex_token,
            ],
            'timeout' => 15,
        ]);

        if (is_wp_error($response)) {
            error_log("[OpenClaw Bridge] Convex webhook failed for order #{$order_id}, product #{$wc_product_id}: " . $response->get_error_message());
            $order->add_order_note("OpenClaw: Failed to create intake form — {$response->get_error_message()}");
            continue;
        }

        $resp_body = json_decode(wp_remote_retrieve_body($response), true);
        $resp_code = wp_remote_retrieve_response_code($response);

        if ($resp_code !== 200 || empty($resp_body['accessToken'])) {
            $err = $resp_body['error'] ?? "HTTP {$resp_code}";
            error_log("[OpenClaw Bridge] Convex webhook non-200 for order #{$order_id}: {$err}");
            $order->add_order_note("OpenClaw: Webhook error — {$err}");
            continue;
        }

        // Store the access token for redirect on thank-you page
        $order->update_meta_data('_openclaw_access_token', $resp_body['accessToken']);
        $order->update_meta_data('_openclaw_product_slug', $resp_body['productSlug'] ?? '');
        $order->update_meta_data('_openclaw_order_id', $resp_body['orderId'] ?? '');
        $order->save();

        $order->add_order_note(
            sprintf('OpenClaw: Intake form ready for %s (product %d).', $resp_body['productSlug'] ?? 'unknown', $wc_product_id)
        );
    }
}, 10, 1);

// ─── WC THANK-YOU PAGE REDIRECT ─────────────────────────────────────
// After payment, redirect customer to the inta