c3RvbWVyLgogICAgcmVnaXN0ZXJfcmVzdF9yb3V0ZShPUEVOQ0xBV19CUklER0VfTkFNRVNQQUNFLCAnL3N1YnNjcmlwdGlvbi9zdGF0dXMnLCBbCiAgICAgICAgJ21ldGhvZHMnID0+ICdHRVQnLAogICAgICAgICdjYWxsYmFjaycgPT4gJ29wZW5jbGF3X2dldF9zdWJzY3JpcHRpb25fc3RhdHVzJywKICAgICAgICAncGVybWlzc2lvbl9jYWxsYmFjaycgPT4gJ29wZW5jbGF3X2htYWNfcGVybWlzc2lvbicsCiAgICAgICAgJ2FyZ3MnID0+IFsKICAgICAgICAgICAgJ2VtYWlsJyA9PiBbCiAgICAgICAgICAgICAgICAncmVxdWlyZWQnID0+IHRydWUsCiAgICAgICAgICAgICAgICAndHlwZScgPT4gJ3N0cmluZycsCiAgICAgICAgICAgICAgICAnc2FuaXRpemVfY2FsbGJhY2snID0+ICdzYW5pdGl6ZV9lbWFpbCcsCiAgICAgICAgICAgICAgICAndmFsaWRhdGVfY2FsbGJhY2snID0+IGZ1bmN0aW9uICgkdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNfZW1haWwoJHZhbHVlKTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF0sCiAgICAgICAgXSwKICAgIF0pOwoKICAgIC8vIEdFVCAvb3BlbmNsYXcvdjEvc3Vic2NyaXB0aW9uL2FsbC1hY3RpdmUKICAgIC8vIFJldHVybnMgYWxsIGFjdGl2ZSBzdWJzY3JpcHRpb25zIHdpdGggdGhlaXIgZmxlZXQgYWNjZXNzIHByb2ZpbGVzLgogICAgLy8gVXNlZCBieSBkaXNwYXRjaGVyIG9uIHN0YXJ0dXAgdG8gYnVpbGQgdGhlIGN1c3RvbWVyIGFjY2VzcyBtYXAuCiAgICByZWdpc3Rlcl9yZXN0X3JvdXRlKE9QRU5DTEFXX0JSSURHRV9OQU1FU1BBQ0UsICcvc3Vic2NyaXB0aW9uL2FsbC1hY3RpdmUnLCBbCiAgICAgICAgJ21ldGhvZHMnID0+ICdHRVQnLAogICAgICAgICdjYWxsYmFjaycgPT4gJ29wZW5jbGF3X2dldF9hbGxfYWN0aXZlX3N1YnNjcmlwdGlvbnMnLAogICAgICAgICdwZXJtaXNzaW9uX2NhbGxiYWNrJyA9PiAnb3BlbmNsYXdfaG1hY19wZXJtaXNzaW9uJywKICAgIF0pOwoKICAgIC8vIFBPU1QgL29wZW5jbGF3L3YxL2ZsZWV0L2hlYWx0aAogICAgLy8gRmxlZXQgcmVwb3J0cyBpdHMgc3RhdHVzLiBXb3JkUHJlc3Mgc3RvcmVzIGl0IGZvciB0aGUgY3VzdG9tZXIgZGFzaGJvYXJkLgogICAgcmVnaXN0ZXJfcmVzdF9yb3V0ZShPUEVOQ0xBV19CUklER0VfTkFNRVNQQUNFLCAnL2ZsZWV0L2hlYWx0aCcsIFsKICAgICAgICAnbWV0aG9kcycgPT4gJ1BPU1QnLAogICAgICAgICdjYWxsYmFjaycgPT4gJ29wZW5jbGF3X3JlY2VpdmVfZmxlZXRfaGVhbHRoJywKICAgICAgICAncGVybWlzc2lvbl9jYWxsYmFjaycgPT4gJ29wZW5jbGF3X2htYWNfcGVybWlzc2lvbicsCiAgICBdKTsKCiAgICAvLyBHRVQgL29wZW5jbGF3L3YxL2JyaWRnZS92ZXJpZnkKICAgIC8vIEhlYWx0aCBjaGVjayDigJQgY29uZmlybXMgYnJpZGdlIHBsdWdpbiBpcyBhY3RpdmUgYW5kIGF1dGggd29ya3MuCiAgICByZWdpc3Rlcl9yZXN0X3JvdXRlKE9QRU5DTEFXX0JSSURHRV9OQU1FU1BBQ0UsICcvYnJpZGdlL3ZlcmlmeScsIFsKICAgICAgICAnbWV0aG9kcycgPT4gJ0dFVCcsCiAgICAgICAgJ2NhbGxiYWNrJyA9PiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgV1BfUkVTVF9SZXNwb25zZShbCiAgICAgICAgICAgICAgICAnb2snID0+IHRydWUsCiAgICAgICAgICAgICAgICAndmVyc2lvbicgPT4gT1BFTkNMQVdfQlJJREdFX1ZFUlNJT04sCiAgICAgICAgICAgICAgICAnd29vY29tbWVyY2UnID0+IGNsYXNzX2V4aXN0cygnV29vQ29tbWVyY2UnKSwKICAgICAgICAgICAgICAgICdzdWJzY3JpcHRpb25zJyA9PiBjbGFzc19leGlzdHMoJ1dDX1N1YnNjcmlwdGlvbnMnKSwKICAgICAgICAgICAgXSwgMjAwKTsKICAgICAgICB9LAogICAgICAgICdwZXJtaXNzaW9uX2NhbGxiYWNrJyA9PiAnb3BlbmNsYXdfaG1hY19wZXJtaXNzaW9uJywKICAgIF0pOwoKICAgIC8vIFBPU1QgL29wZW5jbGF3L3YxL2JyaWRnZS9jb25maWcKICAgIC8vIFNldCBPcGVuQ2xhdyBjb25maWd1cmF0aW9uIG9wdGlvbnMgKEhNQUMtYXV0aGVudGljYXRlZCkuCiAgICAvLyBBbGxvd3MgZmxlZXQgdG8gY29uZmlndXJlIENvbnZleCBVUkxzIGFuZCBkYXNoYm9hcmQgVVJMIHJlbW90ZWx5LgogICAgcmVnaXN0ZXJfcmVzdF9yb3V0ZShPUEVOQ0xBV19CUklER0VfTkFNRVNQQUNFLCAnL2JyaWRnZS9jb25maWcnLCBbCiAgICAgICAgJ21ldGhvZHMnID0+ICdQT1NUJywKICAgICAgICAnY2FsbGJhY2snID0+IGZ1bmN0aW9uIChXUF9SRVNUX1JlcXVlc3QgJHJlcXVlc3QpIHsKICAgICAgICAgICAgJGRhdGEgPSAkcmVxdWVzdC0+Z2V0X2pzb25fcGFyYW1zKCk7CiAgICAgICAgICAgICRhbGxvd2VkX2tleXMgPSBbCiAgICAgICAgICAgICAgICAnb3BlbmNsYXdfY29udmV4X3NpdGVfdXJsJywKICAgICAgICAgICAgICAgICdvcGVuY2xhd19jb252ZXhfYXBpX3Rva2VuJywKICAgICAgICAgICAgICAgICdvcGVuY2xhd19kYXNoYm9hcmRfdXJsJywKICAgICAgICAgICAgXTsKICAgICAgICAgICAgJHVwZGF0ZWQgPSBbXTsKICAgICAgICAgICAgZm9yZWFjaCAoJGFsbG93ZWRfa2V5cyBhcyAka2V5KSB7CiAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJGRhdGFbJGtleV0pKSB7CiAgICAgICAgICAgICAgICAgICAgdXBkYXRlX29wdGlvbigka2V5LCBzYW5pdGl6ZV90ZXh0X2ZpZWxkKCRkYXRhWyRrZXldKSwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICR1cGRhdGVkW10gPSAka2V5OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBuZXcgV1BfUkVTVF9SZXNwb25zZShbCiAgICAgICAgICAgICAgICAnb2snID0+IHRydWUsCiAgICAgICAgICAgICAgICAndXBkYXRlZCcgPT4gJHVwZGF0ZWQsCiAgICAgICAgICAgIF0sIDIwMCk7CiAgICAgICAgfSwKICAgICAgICAncGVybWlzc2lvbl9jYWxsYmFjaycgPT4gJ29wZW5jbGF3X2htYWNfcGVybWlzc2lvbicsCiAgICBdKTsKCiAgICAvLyBHRVQgL29wZW5jbGF3L3YxL2JyaWRnZS9jb25maWcKICAgIC8vIFJlYWQgY3VycmVudCBPcGVuQ2xhdyBjb25maWd1cmF0aW9uIChITUFDLWF1dGhlbnRpY2F0ZWQpLgogICAgcmVnaXN0ZXJfcmVzdF9yb3V0ZShPUEVOQ0xBV19CUklER0VfTkFNRVNQQUNFLCAnL2JyaWRnZS9jb25maWcnLCBbCiAgICAgICAgJ21ldGhvZHMnID0+ICdHRVQnLAogICAgICAgICdjYWxsYmFjaycgPT4gZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IFdQX1JFU1RfUmVzcG9uc2UoWwogICAgICAgICAgICAgICAgJ29wZW5jbGF3X2NvbnZleF9zaXRlX3VybCcgPT4gZ2V0X29wdGlvbignb3BlbmNsYXdfY29udmV4X3NpdGVfdXJsJywgJycpLAogICAgICAgICAgICAgICAgJ29wZW5jbGF3X2NvbnZleF9hcGlfdG9rZW4nID0+IGdldF9vcHRpb24oJ29wZW5jbGF3X2NvbnZleF9hcGlfdG9rZW4nKSA/ICcqKipTRVQqKionIDogJycsCiAgICAgICAgICAgICAgICAnb3BlbmNsYXdfZGFzaGJvYXJkX3VybCcgPT4gZ2V0X29wdGlvbignb3BlbmNsYXdfZGFzaGJvYXJkX3VybCcsICcnKSwKICAgICAgICAgICAgXSwgMjAwKTsKICAgICAgICB9LAogICAgICAgICdwZXJtaXNzaW9uX2NhbGxiYWNrJyA9PiAnb3BlbmNsYXdfaG1hY19wZXJtaXNzaW9uJywKICAgIF0pOwp9KTsKCi8vIOKUgOKUgOKUgCBFTkRQT0lOVCBIQU5ETEVSUyDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDi